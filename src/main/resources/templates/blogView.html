<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пост</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .post { margin-bottom: 40px; }
        .comments { margin-top: 20px; }
        .comment { margin-bottom: 10px; }
    </style>
</head>
<body>
<a th:href="@{/blog}">Все посты</a>
<div class="post">
    <h1 th:text="${blog.title}"/>
    <img th:src="'data:image/png;base64, '+${blog.picture}" alt="Картинка"/>
    <p th:text="${blog.text}"/>
    <div>
        <strong th:text="'Теги: '+${blog.tags}"/>
    </div>
    <form th:action="@{/blog/{id}(id=${blog.id})}" method="post" style="display:inline;">
        <input type="hidden" name="_method" value="delete"/>
        <button type="submit">Удалить пост</button>
    </form>
    <button onclick="alert('Редактирование поста');">Редактировать пост</button>
    <div>
        <form th:action="@{/blog/{id}(id=${blog.id})}" method="post" style="display:inline;">
            <input type="hidden" name="_method" value="like"/>
            <button type="submit">Лайк <span id="likeCount" th:text="${blog.likeCount}"/></button>
        </form>
    </div>
    <div style="display:none;" id="commentEdt_0">
        <form th:action="@{/blog/{id}(id=${blog.id})}" method="post">
            <input type="hidden" name="_method" value="newComment"/>
            <input type="hidden" name="blog" id="blog" th:value="${blog.id}"/>
            <textarea name="comment" id="comment" rows="4" cols="50" maxlength="1024"
                      onkeydown="checkKey(event, this.form)"></textarea>
            <button type="submit">Сохранить</button>
            <button type="button" onclick="cancelComment(0);">Отмена</button>
        </form>
    </div>

    <div style="display:block;" id="commentView_0">
        <button onclick="editComment(0);">Добавить комментарий</button>
    </div>
</div>

<div class="comments">
    <h2>Комментарии</h2>

    <div class="comment" th:each="comment: ${comments}">
        <div style="display:none;" th:id="'commentEdt_'+${comment.id}">
            <form th:action="@{/blog/{id}(id=${blog.id})}" method="post">
                <input type="hidden" name="_method" value="editComment"/>
                <input type="hidden" name="id" id="id" th:value="${comment.id}"/>
                <input type="hidden" name="blog" id="blog" th:value="${blog.id}"/>
                <textarea name="comment" id="comment" rows="4" cols="50" maxlength="1024"
                          onkeydown="checkKey(event, this.form)"
                          th:text="${comment.comment}"/>
                <button type="submit">Сохранить</button>
                <button type="button" th:onclick="'cancelComment('+${comment.id}+');'">Отмена</button>
            </form>
        </div>
        <div style="display:block;" th:id="'commentView_'+${comment.id}">
            <p th:text="${comment.comment}"/>
            <button th:onclick="'editComment('+${comment.id}+');'">Редактировать</button>
            <form th:action="@{/blog/{id}(id=${blog.id})}" method="post" style="display:inline;">
                <input type="hidden" name="_method" value="deleteComment"/>
                <input type="hidden" name="comment" th:value="${comment.id}"/>
                <button type="submit">Удалить</button>
            </form>
        </div>
    </div>
</div>

<script>
    function checkKey(e, form) {
        if (e.ctrlKey && e.keyCode == 13) form.submit();
    }

    function editComment(button) {
        document.getElementById('commentEdt_'+button).style.display = 'block';
        document.getElementById('commentView_'+button).style.display = 'none';
        return false;
    };

    function cancelComment(button) {
        document.getElementById('commentEdt_'+button).style.display = 'none';
        document.getElementById('commentView_'+button).style.display = 'block';
        return false;
    };


</script>

</body>
</html>